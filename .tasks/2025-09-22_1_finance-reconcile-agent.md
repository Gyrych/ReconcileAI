# 背景

文件名：2025-09-22_1_finance-reconcile-agent.md
创建于：2025-09-22_14:00:00
创建者：user
主分支：main
任务分支：task/finance-reconcile-agent_2025-09-22_1
Yolo 模式：Off

# 任务描述

开发一个纯前端的财务表单核对 Agent：
- 用户上传两份 Excel 表格，其中一份为标准表，另一份为待核对表。
- 系统将条目解析成 JSON，调用大模型 API 进行归类和汇总。
- 前端完成金额计算、差异比对、可视化动画展示，并提供可选的人工分类确认。
- 流程可分为上传/解析 → AI归类 → 人工确认 → 金额汇总 → 对比结果 → AI总结。

按照以下8个步骤进行开发：

第一步：文件上传和解析
- 功能：允许用户上传两份 Excel 文件（标准表 / 待核对表）。
- 要求：使用 SheetJS (xlsx) 解析 Excel 文件为 JSON，确保标准表的金额标记为 "standard"，待核对表为 "check"。

第二步：原始条目展示
- 功能：展示上传后解析的条目。
- 要求：左侧显示标准表条目列表（蓝色），右侧显示待核对表条目列表（绿色），条目逐条飞入列表（Framer Motion）。

第三步：AI自动归类
- 功能：调用大模型 API，将条目自动归类。
- 输入：标准表 JSON + 待核对表 JSON，输出分类 JSON。

第四步：人工分类确认
- 功能：用户可查看 AI 的归类结果，并拖拽条目调整类别。
- 要求：支持条目在类别卡片间拖拽，高亮 AI 不确定条目。

第五步：金额汇总对比
- 功能：对每个类别统计标准表和待核对表金额总和，并比较差异。
- 要求：计算每个类别金额总和，对比标准表金额，可视化柱状图。

第六步：AI总结报告
- 功能：生成自然语言总结，解释差异和异常。
- 前端效果：打字机动画显示 AI 总结。

第七步：状态机控制
- 使用 React 状态机 / XState 控制整个流程。
- 用户可选择跳过人工确认，直接进入金额汇总与对比。

第八步：API Key管理
- 前端提供输入框让用户输入 Key，存储在 localStorage。
- 所有大模型 API 调用使用用户提供的 Key。

# 项目概览

这是一个全新的React + TypeScript + Vite项目，需要从头搭建。
技术栈：
- React 18
- TypeScript
- Vite
- Framer Motion (动画)
- ECharts/D3.js (可视化)
- SheetJS (xlsx解析)
- 大模型API集成
- 拖拽功能 (react-beautiful-dnd / dnd-kit)
- 状态管理 (React状态机 / XState)

⚠️ 警告：永远不要修改此部分 ⚠️
[此部分应包含核心 RIPER-5 协议规则的摘要，确保它们可以在整个执行过程中被引用]
⚠️ 警告：永远不要修改此部分 ⚠️

# 分析

## 技术选型确认
- **大模型API**：DeepSeek API集成
- **可视化库**：D3.js（支持自定义超炫动画效果）
- **拖拽库**：dnd-kit（现代化，支持复杂动画）
- **状态管理**：XState（可扩展性强，完整的功能支持）
- **国际化**：中文和英文切换支持
- **动画重点**：超炫动画效果作为核心特色
- **数据规模**：1000条以内数据处理

## 核心技术栈
- **前端框架**：React 18 + TypeScript + Vite
- **文件处理**：SheetJS (xlsx) - Excel解析
- **动画引擎**：Framer Motion + D3.js 动画
- **拖拽交互**：@dnd-kit/core + @dnd-kit/sortable
- **状态管理**：XState - 流程状态机
- **可视化**：D3.js - 自定义动画图表
- **AI集成**：DeepSeek API
- **国际化**：react-i18next
- **样式**：Tailwind CSS + Framer Motion
- **图标**：Lucide React

## 性能考虑
- **数据处理**：1000条以内，内存和渲染性能优化
- **动画性能**：大量条目动画的GPU加速和优化
- **状态同步**：复杂状态机的性能监控
- **内存管理**：大数据量的垃圾回收优化

## 架构设计原则
1. **功能完整性**：确保每个步骤都完整实现
2. **可扩展性**：模块化设计，支持功能扩展
3. **动画优先**：超炫动画效果作为核心竞争力
4. **用户体验**：流畅的交互和视觉反馈
5. **错误处理**：完善的异常处理和用户提示

# 提议的解决方案

[行动计划 - 待补充]

# 当前执行步骤："[步骤编号和名称]"

- "1. 项目初始化和依赖安装"

# 任务进度

[带时间戳的变更历史 - 待补充]

# 最终审查

[完成后的总结 - 待补充]
