<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Key è°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        .debug-panel { background: #2a2a2a; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .status { padding: 5px 10px; border-radius: 4px; margin: 5px 0; }
        .success { background: #0f5132; color: #d1e7dd; }
        .error { background: #842029; color: #ea868f; }
        .warning { background: #664d03; color: #fff3cd; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; background: #333; color: #fff; }
    </style>
</head>
<body>
    <h1>ğŸ”§ API Key è°ƒè¯•å·¥å…·</h1>

    <div class="debug-panel">
        <h2>LocalStorage æ£€æŸ¥</h2>
        <div id="localStorageStatus"></div>
        <button onclick="checkLocalStorage()">æ£€æŸ¥ LocalStorage</button>
        <button onclick="clearLocalStorage()">æ¸…é™¤ LocalStorage</button>
    </div>

    <div class="debug-panel">
        <h2>API Key æ ¼å¼éªŒè¯</h2>
        <input type="password" id="apiKeyInput" placeholder="è¾“å…¥APIå¯†é’¥è¿›è¡ŒéªŒè¯" style="width: 300px;">
        <button onclick="validateApiKey()">éªŒè¯æ ¼å¼</button>
        <div id="validationResult"></div>
    </div>

    <div class="debug-panel">
        <h2>åº”ç”¨ç¨‹åºçŠ¶æ€</h2>
        <div id="appStatus"></div>
        <button onclick="checkAppStatus()">æ£€æŸ¥åº”ç”¨çŠ¶æ€</button>
    </div>

    <script>
        function checkLocalStorage() {
            const statusDiv = document.getElementById('localStorageStatus');
            const apiKey = localStorage.getItem('deepseek-api-key');
            const language = localStorage.getItem('language');

            statusDiv.innerHTML = `
                <div class="status ${apiKey ? 'success' : 'warning'}">
                    API Key: ${apiKey ? `${apiKey.length} å­—ç¬¦` : 'æœªè®¾ç½®'}
                </div>
                <div class="status ${language ? 'success' : 'warning'}">
                    è¯­è¨€è®¾ç½®: ${language || 'æœªè®¾ç½®'}
                </div>
            `;

            console.log('LocalStorage å†…å®¹:', {
                'deepseek-api-key': apiKey ? `${apiKey.length} å­—ç¬¦` : null,
                language,
                timestamp: new Date().toISOString()
            });
        }

        function clearLocalStorage() {
            localStorage.removeItem('deepseek-api-key');
            localStorage.removeItem('language');
            checkLocalStorage();
            alert('LocalStorage å·²æ¸…é™¤');
        }

        function validateApiKey() {
            const input = document.getElementById('apiKeyInput');
            const resultDiv = document.getElementById('validationResult');
            const key = input.value;

            const isValidFormat = key.startsWith('sk-') && key.length > 20;
            const isValidLength = key.length >= 35 && key.length <= 200; // åˆç†çš„API keyé•¿åº¦èŒƒå›´

            resultDiv.innerHTML = `
                <div class="status ${isValidFormat ? 'success' : 'error'}">
                    æ ¼å¼æ£€æŸ¥: ${isValidFormat ? 'âœ… ä»¥ sk- å¼€å¤´ä¸”é•¿åº¦ > 20' : 'âŒ æ ¼å¼æ— æ•ˆ'}
                </div>
                <div class="status ${isValidLength ? 'success' : 'warning'}">
                    é•¿åº¦æ£€æŸ¥: ${key.length} å­—ç¬¦ ${isValidLength ? 'âœ…' : '(å»ºè®®: 35-200å­—ç¬¦)'}
                </div>
                <div class="status ${isValidFormat && isValidLength ? 'success' : 'error'}">
                    æ€»ä½“ç»“æœ: ${isValidFormat && isValidLength ? 'âœ… APIå¯†é’¥æ ¼å¼æœ‰æ•ˆ' : 'âŒ APIå¯†é’¥æ ¼å¼æ— æ•ˆ'}
                </div>
            `;

            console.log('API Key éªŒè¯ç»“æœ:', {
                keyLength: key.length,
                startsWithSk: key.startsWith('sk-'),
                isValidFormat,
                isValidLength,
                timestamp: new Date().toISOString()
            });
        }

        function checkAppStatus() {
            const statusDiv = document.getElementById('appStatus');

            // å°è¯•è®¿é—®ä¸»åº”ç”¨ç¨‹åºçš„å…¨å±€å¯¹è±¡
            const hasDebugFunctions = typeof window.testStateMachine !== 'undefined';
            const hasSyncFunction = typeof window.syncApiKey !== 'undefined';

            statusDiv.innerHTML = `
                <div class="status ${hasDebugFunctions ? 'success' : 'warning'}">
                    è°ƒè¯•å‡½æ•°: ${hasDebugFunctions ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}
                </div>
                <div class="status ${hasSyncFunction ? 'success' : 'warning'}">
                    APIåŒæ­¥å‡½æ•°: ${hasSyncFunction ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}
                </div>
            `;

            if (hasDebugFunctions) {
                console.log('è°ƒè¯•å‡½æ•°å¯ç”¨');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            checkLocalStorage();
            checkAppStatus();
        };

        // æ¯5ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
        setInterval(() => {
            checkLocalStorage();
        }, 5000);
    </script>
</body>
</html>
